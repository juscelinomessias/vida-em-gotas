<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="icon" href="../../assets/img/nome-vida-em-gotas.png" type="image/ico">
    
    <title>Admin - Vida em Gotas - Criar Notícias</title>
   
    <script src="../../admin/js/auth/autorizacao.js"></script>

    <!-- Bootstrap -->
    <link href="../../vendors/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="../../vendors/font-awesome/css/font-awesome.min.css" rel="stylesheet">
    <!-- NProgress -->
    <link href="../../vendors/nprogress/nprogress.css" rel="stylesheet">
    <!-- iCheck -->
    <link href="../../vendors/iCheck/skins/flat/green.css" rel="stylesheet">
    <!-- bootstrap-wysiwyg -->
    <link href="../../vendors/google-code-prettify/bin/prettify.min.css" rel="stylesheet">
    <!-- Select2 -->
    <link href="../../vendors/select2/dist/css/select2.min.css" rel="stylesheet">
    <!-- Switchery -->
    <link href="../../vendors/switchery/dist/switchery.min.css" rel="stylesheet">
    <!-- starrr -->
    <link href="../../vendors/starrr/dist/starrr.css" rel="stylesheet">
    <!-- bootstrap-daterangepicker -->
    <link href="../../vendors/bootstrap-daterangepicker/daterangepicker.css" rel="stylesheet">
    <!-- Custom Theme Style -->
    <link href="../../build/css/custom.min.css" rel="stylesheet">

    <!-- Importando o Menu -->
    <script src="../../admin/components/menu_left/index.js"></script>
    <script src="../../admin/components/menu_top/index.js"></script>
    <script src="../../admin/components/menu_footer/index.js"></script>

    <style>
        #seg-tab.active {
            background-color: #26B99A;
            border-color: #169F85;
            color: white;
        }

        .nav-pills .nav-link.active, .nav-pills .show>.nav-link {
            background-color: #26B99A;
            color: #fff;
        }

        .upload-area {
            border: 2px dashed #169F85;
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            color: #666;
            cursor: pointer;
            transition: background-color 0.2s ease;
            position: relative;
        }

        .upload-area:hover {
            background-color: #f0f8ff;
        }

        .upload-area img {
            max-width: 100%;
            max-height: 150px;
            object-fit: cover;
            border-radius: 5px;
            margin-top: -5px;
        }

        .upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .file-preview {
            margin-top: 5px;
        }

        .svg-placeholder {
            width: 50px;
            height: 50px;
            margin: 0 auto;
            margin-top: -10px;
        }
    </style>

</head>

<body class="nav-md">
    
    <script>
        // Verifica se o usuário está autenticado
        checarAutorizacao();
    </script>
    
    <div class="container body" id="conteudo">
        <div class="main_container">
            <div class="col-md-3 left_col">
                <div class="left_col scroll-view">
                    <div class="navbar nav_title" style="border: 0; padding-left: 20px;">
                        <a href="/admin" class="site_title"><span>Vida Em Gotas</span></a>
                    </div>

                    <div class="clearfix"></div>

                    <br />

                    <!-- sidebar menu -->
                    <menu-left></menu-left>
                    <!-- /sidebar menu -->                

                </div>
            </div>

            <!-- top navigation -->
            <menu-top></menu-top>
            <!-- /top navigation -->

            <!-- page content -->
            <div class="right_col" role="main">
                <div class="">
                    <div class="page-title">
                        <div class="title_left">
                            <h3>Criar Notícia</h3>
                        </div>
                        <div class="title_right">
							<div class="col-md-12 col-sm-12 form-group">  <!-- Ocupa toda a largura -->
								<div class="float-right">  <!-- Flutuação à direita -->
									<a href="/admin/noticias/listar-noticias" class="btn btn-primary">
										<i class="fa fa-list"></i> Voltar para Lista
									</a>
								</div>
							</div>
						</div>
                    </div>
                    <div class="clearfix"></div>
                    <div class="row">
                        <div class="col-md-12 col-sm-12">
                            <form id="formNoticias" enctype="multipart/form-data" class="form-horizontal form-label-left">
                                <h2 class="h5 font-weight-medium">Informações da Notícia</h2>
                            
                                <!-- Título -->
                                <div class="mb-3 row">
                                    <label class="col-form-label col-md-4 col-sm-4 label-align" for="titulo">Título*</label>
                                    <div class="col-md-8 col-sm-8">
                                        <input class="form-control" type="text" name="titulo" id="titulo" required>
                                    </div>
                                </div>
                            
                                <!-- Descrição -->
                                <div class="mb-3 row">
                                    <label class="col-form-label col-md-4 col-sm-4 label-align" for="descricao">Descrição*</label>
                                    <div class="col-md-8 col-sm-8">
                                        <textarea class="form-control" name="descricao" id="descricao" rows="10" required></textarea>
                                    </div>
                                </div>
                            
                                <!-- Destacada -->
                                <div class="mb-3 row">
                                    <label class="col-form-label col-md-4 col-sm-4 label-align" for="destacada">Destacada</label>
                                    <div class="col-md-8 col-sm-8">
                                        <select class="form-control" name="destacada" id="destacada" required>
                                            <option value="false">Não</option>
                                            <option value="true">Sim</option>
                                        </select>
                                    </div>
                                </div>
                            
                                <div class="ln_solid"></div>
                            
                                <h2 class="h5 font-weight-medium">Imagens da Notícia</h2>
                                <div class="item form-group">
                                    <label class="col-form-label col-md-4 col-sm-4 label-align">Adicionar Imagens</label>
                                    <div class="col-md-8 col-sm-8">
                                        <div class="row">
                                            <!-- 1º Arquivo -->
                                            <div class="col-md-4">
                                                <div class="upload-area" onclick="document.getElementById('fileInput1').click()">
                                                    <div id="preview1" class="file-preview">
                                                        <svg class="svg-placeholder" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24">
                                                            <path d="M2 18l4.59-4.59a2 2 0 012.82 0L12 16M2 18V8a2 2 0 012-2h7.5M2 18v2a2 2 0 002 2h12a2 2 0 002-2v-4m-6 0l2 2m-2-2l1.59-1.59a2 2 0 012.82 0L18 16m0 0v-3.17M12 10h.01M18 2v8m4-4h-8"></path>
                                                        </svg>
                                                    </div>
                                                    <input type="file" id="fileInput1" class="d-none" name="imagens" accept="image/*" onchange="previewFile(1)">
                                                </div>
                                            </div>
                                        
                                            <!-- 2º Arquivo -->
                                            <div class="col-md-4">
                                                <div class="upload-area" onclick="document.getElementById('fileInput2').click()">
                                                    <div id="preview2" class="file-preview">
                                                        <svg class="svg-placeholder" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24">
                                                            <path d="M2 18l4.59-4.59a2 2 0 012.82 0L12 16M2 18V8a2 2 0 012-2h7.5M2 18v2a2 2 0 002 2h12a2 2 0 002-2v-4m-6 0l2 2m-2-2l1.59-1.59a2 2 0 012.82 0L18 16m0 0v-3.17M12 10h.01M18 2v8m4-4h-8"></path>
                                                        </svg>
                                                    </div>
                                                    <input type="file" id="fileInput2" class="d-none" name="imagens" accept="image/*" onchange="previewFile(2)">
                                                </div>
                                            </div>
                                        
                                            <!-- 3º Arquivo -->
                                            <div class="col-md-4">
                                                <div class="upload-area" onclick="document.getElementById('fileInput3').click()">
                                                    <div id="preview3" class="file-preview">
                                                        <svg class="svg-placeholder" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24">
                                                            <path d="M2 18l4.59-4.59a2 2 0 012.82 0L12 16M2 18V8a2 2 0 012-2h7.5M2 18v2a2 2 0 002 2h12a2 2 0 002-2v-4m-6 0l2 2m-2-2l1.59-1.59a2 2 0 012.82 0L18 16m0 0v-3.17M12 10h.01M18 2v8m4-4h-8"></path>
                                                        </svg>
                                                    </div>
                                                    <input type="file" id="fileInput3" class="d-none" name="imagens" accept="image/*" onchange="previewFile(3)">
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            
                                <div class="ln_solid"></div>
                            
                                <!-- Botão de Salvar -->
                                <div class="mb-3 row">
                                    <div class="col-md-8 offset-md-4">
                                        <button type="submit" class="btn btn-success" id="btn-submit">
                                            <span id="submit-text">Salvar Notícia</span>
                                            <span id="loading-spinner" class="spinner-border spinner-border-sm d-none" role="status" aria-hidden="true"></span>
                                        </button>
                                    </div>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
            
            <script>
                // Função para pré-visualizar arquivos
                function previewFile(id) {
                    const fileInput = document.getElementById(`fileInput${id}`);
                    const preview = document.getElementById(`preview${id}`);
                    const file = fileInput.files[0];
                
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = function() {
                            preview.innerHTML = `<img src="${reader.result}" alt="Preview" class="img-fluid">`;
                        };
                        reader.readAsDataURL(file);
                    } else {
                        preview.innerHTML = `<svg class="svg-placeholder" fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="1" viewBox="0 0 24 24">
                            <path d="M2 18l4.59-4.59a2 2 0 012.82 0L12 16M2 18V8a2 2 0 012-2h7.5M2 18v2a2 2 0 002 2h12a2 2 0 002-2v-4m-6 0l2 2m-2-2l1.59-1.59a2 2 0 012.82 0L18 16m0 0v-3.17M12 10h.01M18 2v8m4-4h-8"></path>
                        </svg>`;
                    }
                }
            
                // Configuração do envio do formulário
                document.getElementById('formNoticias').addEventListener('submit', async (e) => {
    e.preventDefault();
    
    const submitBtn = document.getElementById('btn-submit');
    const submitText = document.getElementById('submit-text');
    const loadingSpinner = document.getElementById('loading-spinner');
    
    // Mostra o loading
    submitBtn.disabled = true;
    submitText.textContent = 'Enviando...';
    loadingSpinner.classList.remove('d-none');

    try {
        const formData = new FormData();
        formData.append('titulo', document.getElementById('titulo').value.trim());
        formData.append('descricao', document.getElementById('descricao').value.trim());
        formData.append('destacada', document.getElementById('destacada').value);

        // Adiciona as imagens
        const fileInputs = [
            document.getElementById('fileInput1'),
            document.getElementById('fileInput2'),
            document.getElementById('fileInput3')
        ];
        
        fileInputs.forEach(input => {
            if (input.files[0]) {
                formData.append('imagens', input.files[0]);
            }
        });

        const response = await fetch('/api/noticias/criar', {
            method: 'POST',
            body: formData
        });

        if (!response.ok) {
            const errorData = await response.json();
            throw new Error(errorData.message || 'Erro ao criar notícia');
        }

        const result = await response.json();
        
        // Mensagem de sucesso com SweetAlert
        Swal.fire({
            icon: 'success',
            title: 'Sucesso!',
            text: 'Notícia cadastrada com sucesso!',
            confirmButtonColor: '#26B99A',
            timer: 2000,
            timerProgressBar: true
        }).then(() => {
            // Redireciona para a lista de notícias ou limpa o formulário
            window.location.href = '/admin/noticias/listar-noticias'; // Ou '/admin/noticias/criarNoticias' para recarregar
            // Alternativa: document.getElementById('formNoticias').reset();
        });

    } catch (err) {
        console.error('Erro:', err);
        
        // Mensagem de erro com SweetAlert
        Swal.fire({
            icon: 'error',
            title: 'Erro',
            text: err.message || 'Erro ao se conectar ao servidor. Por favor, tente novamente.',
            confirmButtonColor: '#26B99A'
        });
    } finally {
        // Restaura o botão
        submitBtn.disabled = false;
        submitText.textContent = 'Salvar Notícia';
        loadingSpinner.classList.add('d-none');
    }
});
            
            </script>
        
            <!-- Bootstrap JS -->
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
            
            <!-- /page content -->

            <!-- footer content -->
            <menu-footer></menu-footer>
            <!-- /footer content -->
        </div>
    </div>

    <!-- jQuery -->
    <script src="../../vendors/jquery/dist/jquery.min.js"></script>
    <!-- Bootstrap -->
    <script src="../../vendors/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <!-- FastClick -->
    <script src="../../vendors/fastclick/lib/fastclick.js"></script>
    <!-- NProgress -->
    <script src="../../vendors/nprogress/nprogress.js"></script>
    <!-- bootstrap-progressbar -->
    <script src="../../vendors/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
    <!-- iCheck -->
    <script src="../../vendors/iCheck/icheck.min.js"></script>
    <!-- bootstrap-daterangepicker -->
    <script src="../../vendors/moment/min/moment.min.js"></script>
    <script src="../../vendors/bootstrap-daterangepicker/daterangepicker.js"></script>
    <!-- bootstrap-wysiwyg -->
    <script src="../../vendors/bootstrap-wysiwyg/js/bootstrap-wysiwyg.min.js"></script>
    <script src="../../vendors/jquery.hotkeys/jquery.hotkeys.js"></script>
    <script src="../../vendors/google-code-prettify/src/prettify.js"></script>
    <!-- jQuery Tags Input -->
    <script src="../../vendors/jquery.tagsinput/src/jquery.tagsinput.js"></script>
    <!-- Switchery -->
    <script src="../../vendors/switchery/dist/switchery.min.js"></script>
    <!-- Select2 -->
    <script src="../../vendors/select2/dist/js/select2.full.min.js"></script>
    <!-- Parsley -->
    <script src="../../vendors/parsleyjs/dist/parsley.min.js"></script>

     <!-- SweetAlert2 -->
     <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Parsley PT-BR -->
    <script src="../../vendors/parsleyjs/dist/i18n/pt-br.js"></script>

    <!-- Autosize -->
    <script src="../../vendors/autosize/dist/autosize.min.js"></script>
    <!-- jQuery autocomplete -->
    <script src="../../vendors/devbridge-autocomplete/dist/jquery.autocomplete.min.js"></script>
    <!-- starrr -->
    <script src="../../vendors/starrr/dist/starrr.js"></script>
    <!-- Custom Theme Scripts -->
    <script src="../../build/js/custom.min.js"></script>
</body>
</html>