<!DOCTYPE html>
<html lang="pt-br">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="Vida em Gotas é uma plataforma web dedicada a incentivar a doação de leite materno, promovendo informação, cadastro e mobilização social para salvar vidas de recém-nascidos.">
  <meta name="keywords" content="doação de leite materno, banco de leite humano, leite materno, saúde neonatal, prematuros, amamentação, voluntariado, Vida em Gotas, coleta de leite humano, geolocalização de postos de coleta, plataforma web de saúde">
  
  <title>Detalhe da Notícia | Vida Em Gotas</title>

  <link rel="icon" href="../../assets/img/nome-vida-em-gotas.png" type="image/ico">    

  <link href="https://fonts.googleapis.com/css2?family=Alegreya+Sans+SC:ital,wght@0,100;0,300;0,400;0,500;0,700;0,800;0,900;1,100;1,300;1,400;1,500;1,700;1,800;1,900&display=swap" rel="stylesheet">
  
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  
  <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="assets/vendor/aos/aos.css" rel="stylesheet">
  <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
  <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

  <link href="assets/css/main.css" rel="stylesheet">

  <script src="assets/components/menu_footer/index.js"></script>
  <script src="assets/components/menu_top/index.js"></script>

   <script src="assets/components/Contatos/WhattAppButton.js"></script>

</head>

<body class="index-page">

<style>

.btn-outline-primary {
    background-color: #fff !important;
    border-color: #5b3101 !important;
    color: #5b3101 !important;
}

.btn-primary {
    background-color: #5b3101 !important;
    border-color: #5b3101 !important;
    color: #fff !important;
}
    
/* Estilos principais */
/* Importando a fonte Props */
@import url('https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Roboto:ital,wght@0,400;0,500;1,300;1,900&display=swap');
        
/* ESTILO PARA TODOS OS PARÁGRAFOS DENTRO DA DESCRIÇÃO */
.descricao-formatada p {
    text-indent: 2em;
    text-align: justify;
    text-justify: inter-word;
    margin-bottom: 1rem;
    line-height: 1.6;
    color: #5b3101;
}

/* Remove recuo em parágrafos vazios */
.descricao-formatada p:empty {
     display: none;
}
    
/* Estilo para títulos dentro da descrição */
.descricao-formatada h4 {
    text-indent: 0 !important;
    margin-top: 1.5rem;
    color: #5b3101;
}
    
/* Botões */
.btn-outline-primary {
    background-color: #fff !important;
    border-color: #5b3101 !important;
    color: #5b3101 !important;
}

.btn-primary {
    background-color: #5b3101 !important;
    border-color: #5b3101 !important;
    color: #fff !important;
}
    
/* Título principal */
.main-title {
    font-size: 2rem;
    margin-bottom: 20px;
    color: #5b3101;
    font-weight: 600;
    text-align: center;
}
    
/* Container para imagens */
.single-column-container {
    width: 100%;
    margin-bottom: 30px;
}
    
/* Estilo para crop de imagens */
.image-crop-container {
    width: 100%;
    height: auto; /* A altura se ajusta conforme a imagem */
    border-radius: 8px;
    box-shadow: 0 3px 10px rgba(0,0,0,0.1);
    margin-bottom: 15px;
    overflow: hidden;
}

.image-crop-container img {
    width: 100%;
    height: auto;
    object-fit: contain;
    display: block;
}

.info-card {
    padding: 30px;
}
        
/* Botão de som */
#botao-som {
    transition: all 0.3s ease;
    min-width: 120px;
    float: right;
}
    
/* Responsividade */
@media (max-width: 768px) {
    .main-title {
        font-size: 1.5rem;
    }

    .image-crop-container {
        height: 250px;
    }

    .descricao-formatada p {
        text-indent: 2em;                 
        font-size: 1rem;
    }

    .info-card {
        padding: 16px;
    }

}
        
</style>


<header>

  <!-- Importando a Navegação e o Banner -->
  <menu-top></menu-top>
  <!-- Importando a Navegação e o Banner -->

</header>

<div class="container py-1">
    <div id="detalhes-container" class="row">
        <!-- Conteúdo será substituído via JavaScript -->
        <div class="col-2 text-center my-1">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Carregando...</span>
            </div>
            <p class="mt-2">Carregando detalhes da orientação...</p>
        </div>
    </div>
</div>

  <!-- Componente whatsapp -->
  <whatsapp-button></whatsapp-button>

<footer>

    <!-- Importando o Footer -->
    <menu-footer></menu-footer>
    <!-- Importando o Footer -->

</footer>

<!-- Scroll Top -->
<a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i class="bi bi-arrow-up-short"></i></a>

<!-- Preloader -->
<div id="preloader"></div>

<script>
    document.addEventListener('DOMContentLoaded', async function() {
        try {
            const urlParams = new URLSearchParams(window.location.search);
            const noticiasId = urlParams.get('id');
            
            if (!noticiasId) {
                throw new Error('ID da orientação não foi fornecido na URL');
            }

            const response = await fetch(`/api/noticias/obter-noticia-por-id?id=${noticiasId}`);
            
            if (!response.ok) {
                throw new Error(`Erro HTTP: ${response.status}`);
            }
            
            const { data } = await response.json();

            console.log(data)

            if (!data) {
                throw new Error('Nenhum dado retornado pela API');
            }

            renderizarDetalhes(data);

        } catch (error) {
            console.error('Erro ao carregar detalhes:', error);
            document.getElementById('detalhes-container').innerHTML = `
                <div class="col-12">
                    <div class="alert alert-danger">
                        <h4>Erro ao carregar notícias</h4>
                        <p>${error.message}</p>
                        <a href="noticias.html" class="btn btn-primary">
                            <i class="fas fa-arrow-left me-2"></i> Voltar
                        </a>
                    </div>
                </div>
            `;
        }
    });

    function getImageUrl(img) {
        if (!img) return 'assets/img/placeholder.jpg';
        
        if (img.startsWith('http://') || img.startsWith('https://')) {
            return img;
        }
        
        const cleanedPath = img.startsWith('/') ? img.substring(1) : img;
        return `https://vida-em-gotas.s3.us-east-2.amazonaws.com/${cleanedPath}`;
    }

    function renderizarDetalhes(orientacao) {
    const container = document.getElementById('detalhes-container');
    
    // Processa as imagens em coluna única com crop CSS
    let imagensHtml = '';
    if (orientacao.imagens && orientacao.imagens.length > 0) {
        imagensHtml = `
            <div class="mt-4">
                <div class="single-column-container">
                    ${orientacao.imagens.map((img, index) => {
                        const imgUrl = getImageUrl(img.url || img.imagem || img.key);
                        return `
                            <div class="image-crop-container">
                                <img src="${imgUrl}" 
                                     alt="Imagem ${index + 1}"
                                     onerror="this.onerror=null;this.src='assets/img/placeholder.jpg'">
                            </div>
                        `;
                    }).join('')}
                </div>
            </div>
        `;
    }

    // Monta o HTML completo
    container.innerHTML = `
       <div class="col-lg-12 mx-auto"></div>
       <div class="col-lg-9 mx-auto">
           <br>
           <div class="info-card">
               <h1 class="main-title">${orientacao.titulo || 'Sem título'}</h1>
              
               
               <div class="description-section mb-4">
                   ${formatarDescricao(orientacao.descricao)}
               </div>
               
               ${imagensHtml || ''}
               
               <div class="d-flex justify-content-between text-muted small">
                   <span>
                       <i class="far fa-calendar-alt me-1"></i>
                       Criado em: ${new Date(orientacao.created_at).toLocaleDateString('pt-BR')}
                   </span>
               </div>
               <br>
               <div class="d-flex justify-content-between">
                   <a href="noticias" class="btn btn-outline-secondary">
                       <i class="fas fa-arrow-left me-2"></i> Voltar
                   </a>
                   <button id="botao-som" class="btn btn-outline-primary">
                       <i class="fas fa-volume-up"></i> Ouvir
                   </button>
               </div>
           </div>
       </div>
    `;

    configurarBotaoSom(orientacao);
}

function formatarDescricao(descricao) {
    if (!descricao) return '<p class="text-muted text-center">Nenhuma descrição disponível</p>';
    
    // Processa quebras de linha para criar parágrafos HTML corretos
    let html = descricao
        .replace(/\n\n+/g, '</p><p>')  // Duas quebras = novo parágrafo
        .replace(/\n/g, '<br>');       // Uma quebra = <br>
    
    // Envolve em div com a classe de formatação
    // NOTA: Todos os <p> gerados herdarão o text-indent do CSS
    html = `<div class="descricao-formatada"><p>${html}</p></div>`;
    
    return html;
}

    function configurarBotaoSom(orientacao) {
        const botaoSom = document.getElementById('botao-som');
        let estaFalando = false;
        let vozAtual = null;

        if (botaoSom) {
            botaoSom.addEventListener('click', function() {
                if (estaFalando) {
                    window.speechSynthesis.cancel();
                    botaoSom.innerHTML = '<i class="fas fa-volume-up"></i> Ouvir';
                    botaoSom.classList.remove('btn-primary');
                    botaoSom.classList.add('btn-outline-primary');
                    estaFalando = false;
                } else {
                    // Seleciona conteúdo para ler
                    const conteudoParaLer = [
                        orientacao.titulo,
                        ...Array.from(document.querySelectorAll('.description-section, .descricao-formatada'))
                            .map(el => el.textContent.trim())
                    ].filter(Boolean).join('. ');

                    if (!conteudoParaLer) {
                        alert('Nenhum conteúdo disponível para leitura');
                        return;
                    }

                    vozAtual = new SpeechSynthesisUtterance(conteudoParaLer);
                    vozAtual.lang = 'pt-BR';
                    vozAtual.rate = 0.9;

                    vozAtual.onstart = function() {
                        botaoSom.innerHTML = '<i class="fas fa-volume-up"></i> Parar';
                        botaoSom.classList.remove('btn-outline-primary');
                        botaoSom.classList.add('btn-primary');
                        estaFalando = true;
                    };

                    vozAtual.onend = vozAtual.onerror = function() {
                        botaoSom.innerHTML = '<i class="fas fa-volume-up"></i> Ouvir';
                        botaoSom.classList.remove('btn-primary');
                        botaoSom.classList.add('btn-outline-primary');
                        estaFalando = false;
                    };

                    window.speechSynthesis.speak(vozAtual);
                }
            });
        }
    }

    function formatarDescricao(descricao) {
        if (!descricao) return '<p class="text-muted">Nenhuma descrição disponível</p>';
        
        let html = descricao.replace(/\n\n+/g, '</p><p>');
        html = html.replace(/\n/g, '<br>');
        html = `<div class="descricao-formatada"><p>${html}</p></div>`;
        
        html = html.replace(
            /<p>([A-ZÇÃÁÀÂÉÈÊÍÓÔÕÚÜ\s]{5,})<\/p>/g,
            '<h4 class="descricao-titulo">$1</h4>'
        );
        
        html = html.replace(
            /<h4 class="descricao-titulo">(.*?)<\/h4>/g,
            function(match, titulo) {
                const tituloFormatado = titulo.split(' ')
                    .map(palavra => palavra.charAt(0).toUpperCase() + palavra.slice(1).toLowerCase())
                    .join(' ');
                return `<h4 class="descricao-titulo">${tituloFormatado}</h4>`;
            }
        );
        
        return html;
    }
</script>


<script src="https://code.responsivevoice.org/responsivevoice.js"></script>
<script>
responsiveVoice.speak(document.getElementById('.description-section, .descricao-formatada').innerText, "Brazilian Portuguese Female");
</script>


<!-- Vendor JS Files -->
<script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
<script src="assets/vendor/php-email-form/validate.js"></script>
<script src="assets/vendor/aos/aos.js"></script>
<script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
<script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
<script src="assets/vendor/swiper/swiper-bundle.min.js"></script>

<!-- Main JS File -->
<script src="assets/js/main.js"></script>

</body>

</html>